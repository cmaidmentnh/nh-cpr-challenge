{% extends "base.html" %}
{% block title %}Report Attendance{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8">
    <h1 class="font-serif text-3xl font-bold text-navy-900 mb-2">Report Attendance</h1>
    <p class="text-gray-600 mb-6">Thank you for hosting a CPR training, {{ training.host_name }}!</p>

    <!-- Training Details -->
    <div class="bg-navy-50 rounded-xl p-6 mb-8">
        <h2 class="font-bold text-navy-900 text-lg">{{ training.location_name }}</h2>
        <p class="text-gray-600">{{ training.date.strftime('%A, %B %d, %Y') }} &middot; {{ training.start_time or 'TBD' }}</p>
        <p class="text-gray-500">District {{ training.district }} &middot; {{ training.rsvps.count() }} RSVPs</p>
    </div>

    {% if existing_report %}
    <!-- Already reported -->
    <div class="bg-green-50 rounded-xl p-8 text-center border border-green-200">
        <svg class="w-12 h-12 text-green-600 mx-auto mb-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        <h2 class="text-xl font-bold text-green-800 mb-2">Attendance Already Reported</h2>
        <p class="text-green-700">You reported <strong>{{ existing_report.reported_count }}</strong> attendees.</p>
        {% if not existing_report.approved %}
        <p class="text-green-600 text-sm mt-2">Your report is pending admin approval.</p>
        {% else %}
        <p class="text-green-600 text-sm mt-2">Your report has been approved.</p>
        {% endif %}
    </div>
    {% else %}
    <!-- Report Form -->
    <form method="POST" class="bg-white rounded-xl shadow-md p-8 space-y-6">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Total Number of People Trained *</label>
            <input type="number" name="reported_count" required min="0" max="1000" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500" placeholder="Enter the total count">
            <p class="text-xs text-gray-400 mt-1">Include walk-ins and anyone who participated, not just RSVPs.</p>
        </div>

        {% if rsvps %}
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">Mark RSVPs Who Attended</label>
            <p class="text-xs text-gray-400 mb-3">Check the box next to each person who showed up. This enables their participation certificate.</p>
            <div class="space-y-2 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3">
                {% for r in rsvps %}
                <label class="flex items-center gap-3 py-1 px-2 hover:bg-gray-50 rounded">
                    <input type="checkbox" name="attended" value="{{ r.id }}" class="rounded">
                    <span class="text-sm text-gray-700">{{ r.name }}</span>
                    <span class="text-xs text-gray-400">{{ r.email }}</span>
                </label>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Notes (optional)</label>
            <textarea name="notes" rows="3" placeholder="Any feedback, observations, or notes about the event" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500"></textarea>
        </div>

        <button type="submit" class="w-full bg-navy-900 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-navy-800 transition">
            Submit Attendance Report
        </button>
    </form>
    {% endif %}
</div>
{% endblock %}
