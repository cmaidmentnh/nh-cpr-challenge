{% extends "base.html" %}
{% block title %}RSVP - {{ training.location_name }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 py-8">
    <!-- Training Details -->
    <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
        <div class="h-2" style="background-color: {{ district_colors[training.district] }}"></div>
        <div class="p-6">
            <div class="flex items-center gap-2 mb-2">
                <span class="w-3 h-3 rounded-full" style="background-color: {{ district_colors[training.district] }}"></span>
                <span class="text-sm text-gray-500">District {{ training.district }} &mdash; {{ councilors[training.district]['name'] }}</span>
            </div>
            <h1 class="text-2xl font-bold text-navy-900 mb-1">{{ training.location_name }}</h1>
            {% if training.organization %}
            <p class="text-gray-500">Hosted by {{ training.organization }}</p>
            {% endif %}
            <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="text-gray-400">Date</span>
                    <p class="font-medium text-gray-800">{{ training.date.strftime('%A, %B %d, %Y') }}</p>
                </div>
                <div>
                    <span class="text-gray-400">Time</span>
                    <p class="font-medium text-gray-800">{{ training.start_time or 'TBD' }}{% if training.end_time %} &ndash; {{ training.end_time }}{% endif %}</p>
                </div>
                <div>
                    <span class="text-gray-400">Location</span>
                    <p class="font-medium text-gray-800">{{ training.address or '' }}{% if training.address and training.city %}, {% endif %}{{ training.city or '' }}</p>
                </div>
                <div>
                    <span class="text-gray-400">Availability</span>
                    <p class="font-medium {% if training.is_full %}text-red-600{% else %}text-green-600{% endif %}">
                        {% if training.is_full %}Full{% else %}{{ training.spots_remaining }} spots remaining{% endif %}
                    </p>
                </div>
            </div>
            {% if training.description %}
            <p class="mt-4 text-gray-600 text-sm border-t border-gray-100 pt-4">{{ training.description }}</p>
            {% endif %}
        </div>
    </div>

    {% if training.is_full %}
    <!-- Full -->
    <div class="bg-red-50 rounded-xl p-8 text-center border border-red-200">
        <div class="text-4xl mb-3">&#128532;</div>
        <h2 class="text-xl font-bold text-red-800 mb-2">This Training is Full</h2>
        <p class="text-red-600 mb-4">All {{ training.capacity }} spots have been filled.</p>
        <a href="{{ url_for('trainings') }}" class="inline-block bg-navy-900 text-white px-6 py-2 rounded-lg font-bold hover:bg-navy-800 transition">Find Another Training</a>
    </div>
    {% else %}
    <!-- RSVP Form -->
    <form method="POST" class="bg-white rounded-xl shadow-md p-8 space-y-5">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <h2 class="text-xl font-bold text-navy-900">Reserve Your Spot</h2>
        <p class="text-gray-600 text-sm">It's free! Just fill out the form below and you'll receive a confirmation email.</p>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Your Name *</label>
            <input type="text" name="name" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
            <input type="email" name="email" required class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone (optional)</label>
            <input type="tel" name="phone" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Which district do you live in?</label>
            <select name="district" class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-navy-500 focus:border-navy-500">
                <option value="">Not sure / skip</option>
                {% for d in range(1, 6) %}
                <option value="{{ d }}">District {{ d }} &mdash; {{ councilors[d]['name'] }}</option>
                {% endfor %}
            </select>
            <p class="text-xs text-gray-400 mt-1">This helps us track the challenge by district. <a href="{{ url_for('map_page') }}" class="text-navy-600 underline">Check the map</a></p>
        </div>

        <button type="submit" class="w-full bg-gold hover:bg-gold-dark text-navy-900 font-bold py-3 px-8 rounded-lg text-lg transition">
            Reserve My Spot
        </button>
    </form>
    {% endif %}
</div>
{% endblock %}
